@model IEnumerable<sistemaVeterinario.Models.Role>

@{
    ViewData["Title"] = "Roles";
}

<h1>Roles</h1>

<p>
    <a asp-action="Create">Crear Nuevo Rol</a>
</p>
<table class="table">
    <thead>
        <tr>
            <th>
                @Html.DisplayNameFor(model => model.NombreRol)
            </th>
            <th></th>
        </tr>
    </thead>
    <tbody id="roles-table-body">
@foreach (var item in Model) {
        <tr id="rol-@item.IdRol">
            <td>
                @Html.DisplayFor(modelItem => item.NombreRol)
            </td>
            <td>
                <a asp-action="Edit" asp-route-id="@item.IdRol" class="btn btn-warning btn-sm">Editar</a> |
                <button class="btn btn-danger btn-sm btn-delete" data-id="@item.IdRol" data-name="@item.NombreRol">Eliminar</button>
            </td>
        </tr>
}
    </tbody>
</table>

@section Scripts {
    <script>
        document.getElementById('roles-table-body').addEventListener('click', function (event) {
            if (event.target && event.target.classList.contains('btn-delete')) {
                const rolId = event.target.getAttribute('data-id');
                const rolName = event.target.getAttribute('data-name');

                Swal.fire({
                    title: `¿Estás seguro de que quieres eliminar el rol "${rolName}"?`,
                    text: "¡No podrás revertir esto!",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    confirmButtonText: 'Sí, ¡bórralo!',
                    cancelButtonText: 'Cancelar'
                }).then((result) => {
                    if (result.isConfirmed) {
                        fetch(`/Roles/Delete/${rolId}`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            }
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (data === "ok") {
                                Swal.fire(
                                    '¡Borrado!',
                                    `El rol "${rolName}" ha sido eliminado.`,
                                    'success'
                                ).then(() => {
                                    // Eliminar la fila de la tabla
                                    const row = document.getElementById(`rol-${rolId}`);
                                    row.remove();
                                });
                            } else {
                                Swal.fire(
                                    'Error',
                                    'Ocurrió un error al eliminar el rol.',
                                    'error'
                                );
                            }
                        });
                    }
                });
            }
        });
    </script>
}